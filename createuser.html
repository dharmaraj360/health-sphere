<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HealthSphere - Create User Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-r from-blue-100 to-teal-100 min-h-screen py-12 px-4 sm:px-6 lg:px-8"
  >
    <div
      class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl"
    >
      <div class="md:flex">
        <div class="p-8 w-full">
          <div
            class="uppercase tracking-wide text-sm text-indigo-500 font-semibold mb-1"
          >
            HealthSphere
          </div>
          <h2 class="block mt-1 text-lg leading-tight font-medium text-black">
            Create Your Profile
          </h2>
          <p class="mt-2 text-gray-500">
            Please fill in your health information to complete your profile.
          </p>
          <form id="profileForm" class="mt-6 space-y-6">
            <div class="flex justify-center">
              <div class="relative">
                <img
                  id="profilePreview"
                  src="/api/placeholder/150/150"
                  alt="Profile Photo"
                  class="w-32 h-32 rounded-full object-cover"
                />
                <label
                  for="profilePhoto"
                  class="absolute bottom-0 right-0 bg-indigo-600 text-white rounded-full p-2 cursor-pointer"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                  </svg>
                </label>
                <input
                  type="file"
                  id="profilePhoto"
                  name="profilePhoto"
                  accept="image/*"
                  class="hidden"
                  required
                />
              </div>
            </div>
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700"
                >Full Name</label
              >
              <input
                type="text"
                id="name"
                name="name"
                required
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="dateOfBirth"
                class="block text-sm font-medium text-gray-700"
                >Date of Birth</label
              >
              <input
                type="date"
                id="dateOfBirth"
                name="dateOfBirth"
                required
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="gender"
                class="block text-sm font-medium text-gray-700"
                >Gender</label
              >
              <select
                id="gender"
                name="gender"
                required
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              >
                <option value="">Select Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div>
              <label
                for="height"
                class="block text-sm font-medium text-gray-700"
                >Height (cm)</label
              >
              <input
                type="number"
                id="height"
                name="height"
                required
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="weight"
                class="block text-sm font-medium text-gray-700"
                >Weight (kg)</label
              >
              <input
                type="number"
                id="weight"
                name="weight"
                required
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="bloodType"
                class="block text-sm font-medium text-gray-700"
                >Blood Type</label
              >
              <select
                id="bloodType"
                name="bloodType"
                required
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              >
                <option value="">Select Blood Type</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>
            <div>
              <label
                for="allergies"
                class="block text-sm font-medium text-gray-700"
                >Allergies (comma-separated)</label
              >
              <input
                type="text"
                id="allergies"
                name="allergies"
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="medications"
                class="block text-sm font-medium text-gray-700"
                >Medications (comma-separated)</label
              >
              <input
                type="text"
                id="medications"
                name="medications"
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <label
                for="chronicConditions"
                class="block text-sm font-medium text-gray-700"
                >Chronic Conditions (comma-separated)</label
              >
              <input
                type="text"
                id="chronicConditions"
                name="chronicConditions"
                class="mt-1 block w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
              />
            </div>
            <div>
              <button
                type="submit"
                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
              >
                Create Profile
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>
    <script>
      function showToast(message, isError = false) {
        Toastify({
          text: message,
          duration: 3000,
          close: true,
          gravity: "top",
          position: "right",
          backgroundColor: isError ? "#EF4444" : "#10B981",
          stopOnFocus: true,
        }).showToast();
      }

      document
        .getElementById("profilePhoto")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("profilePreview").src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });

      document
        .getElementById("profileForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);

          try {
            const token = localStorage.getItem("token");
            const response = await axios.post(
              "http://localhost:5000/api/user/profile",
              formData,
              {
                headers: {
                  "Content-Type": "multipart/form-data",
                  Authorization: `Bearer ${token}`,
                },
              }
            );

            showToast("Profile created successfully!");
            setTimeout(() => (window.location.href = "dashboard.html"), 1500);
          } catch (error) {
            showToast(
              "Failed to create profile: " +
                (error.response?.data?.message || "Unknown error"),
              true
            );
          }
        });
    </script>
  </body>
</html>
